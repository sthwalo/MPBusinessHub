import{j as e}from"./index-BTjPMemu.js";import{r as u,u as y,L as g}from"./vendor-BMRKNa3Q.js";import{V as c}from"./ui-BuAqC3bd.js";import"./sentry-CdN5cWpD.js";function S({setIsAuthenticated:h}){const[o,p]=u.useState({email:"",password:"",rememberMe:!1}),[r,l]=u.useState({}),[m,x]=u.useState(!1),f=y(),b=t=>{const{name:a,value:i,type:s,checked:n}=t.target;p(d=>({...d,[a]:s==="checkbox"?n:i})),r[a]&&l(d=>({...d,[a]:""}))},w=()=>{const t={};return o.email?/\S+@\S+\.\S+/.test(o.email)||(t.email="Email is invalid"):t.email="Email is required",o.password||(t.password="Password is required"),l(t),Object.keys(t).length===0},j=async t=>{if(t.preventDefault(),!!w()){x(!0);try{const a=c.loading("Logging in..."),i=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:o.email,password:o.password})});if(c.dismiss(a),!i.ok){const d=await i.json();throw new Error(d.message||"Login failed")}const s=await i.json();console.log("Login successful:",s),localStorage.setItem("mpbh_token",s.data.token);const n={id:s.data.user.id,name:s.data.user.name,email:s.data.user.email};s.data.business&&(n.businessId=s.data.business.id,n.businessName=s.data.business.name,n.businessStatus=s.data.business.status),localStorage.setItem("mpbh_user",JSON.stringify(n)),c.success("Login successful!"),h(!0),f("/dashboard")}catch(a){console.error("Login error:",a),a.response&&a.response.status===422?l({email:"Invalid credentials",password:"Invalid credentials"}):l({form:a.message||"Login failed. Please try again."}),c.error("Login failed. Please check your credentials.")}finally{x(!1)}}};return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"max-w-md mx-auto bg-brand-white rounded-lg shadow-md border border-brand-gray-200 overflow-hidden",children:e.jsxs("div",{className:"p-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-center mb-6",children:"Login to Your Account"}),r.form&&e.jsx("div",{className:"bg-red-50 text-red-800 p-4 rounded-md mb-6",children:r.form}),e.jsxs("form",{onSubmit:j,children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"email",className:"block text-brand-black font-medium mb-1",children:"Email Address"}),e.jsx("input",{type:"email",id:"email",name:"email",className:`w-full p-2 border ${r.email?"border-red-500":"border-brand-gray-300"} rounded focus:outline-none focus:ring-1 focus:ring-brand-black`,value:o.email,onChange:b,placeholder:"youremail@example.com"}),r.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.email})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{htmlFor:"password",className:"block text-brand-black font-medium mb-1",children:"Password"}),e.jsx(g,{to:"/forgot-password",className:"text-sm text-brand-black hover:text-brand-gray-600 border-b border-brand-gray-400",children:"Forgot Password?"})]}),e.jsx("input",{type:"password",id:"password",name:"password",className:`w-full p-2 border ${r.password?"border-red-500":"border-brand-gray-300"} rounded focus:outline-none focus:ring-1 focus:ring-brand-black`,value:o.password,onChange:b,placeholder:"••••••••"}),r.password&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.password})]}),e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("input",{type:"checkbox",id:"rememberMe",name:"rememberMe",checked:o.rememberMe,onChange:b,className:"h-4 w-4 text-brand-black border-brand-gray-300 rounded focus:ring-brand-black"}),e.jsx("label",{htmlFor:"rememberMe",className:"ml-2 text-sm text-brand-gray-700",children:"Remember me"})]}),e.jsx("button",{type:"submit",className:`px-4 py-2 bg-brand-black text-brand-white font-medium rounded hover:bg-brand-gray-800 transition-colors w-full ${m?"opacity-75":""}`,disabled:m,children:m?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 mr-3 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Logging in..."]}):"Login"})]}),e.jsx("div",{className:"text-center mt-6",children:e.jsxs("p",{className:"text-brand-gray-600",children:["Don't have an account?"," ",e.jsx(g,{to:"/register",className:"text-brand-black hover:text-brand-gray-600 border-b border-brand-gray-400 font-medium",children:"Register Your Business"})]})})]})})})}export{S as default};
