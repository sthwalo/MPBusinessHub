import{j as e}from"./index-BTjPMemu.js";import{r as u,u as A,L as h}from"./vendor-BMRKNa3Q.js";import{V as m}from"./ui-BuAqC3bd.js";import"./sentry-CdN5cWpD.js";function L(){const[n,g]=u.useState(1),[t,y]=u.useState({businessName:"",category:"",district:"",description:"",phone:"",email:"",website:"",address:"",password:"",confirmPassword:"",agreeToTerms:!1}),[a,c]=u.useState({}),[x,f]=u.useState(!1),p=A(),v=["Tourism","Agriculture","Construction","Events"],k=["Mbombela","Emalahleni","Bushbuckridge"],l=s=>{const{name:r,value:d,type:i,checked:o}=s.target;y(b=>({...b,[r]:i==="checkbox"?o:d})),a[r]&&c(b=>({...b,[r]:""}))},P=()=>{const s={};return t.businessName.trim()||(s.businessName="Business name is required"),t.category||(s.category="Please select a category"),t.district||(s.district="Please select a district"),t.description.trim()?t.description.length<50&&(s.description="Description should be at least 50 characters"):s.description="Business description is required",c(s),Object.keys(s).length===0},S=()=>{const s={};return t.phone.trim()?/^\+?[\d\s-]{10,15}$/.test(t.phone)||(s.phone="Please enter a valid phone number"):s.phone="Phone number is required",t.email.trim()?/\S+@\S+\.\S+/.test(t.email)||(s.email="Please enter a valid email address"):s.email="Email is required",t.website&&!/^(https?:\/\/)?[\w-]+(\.[\w-]+)+(\/[\w-./?%&=]*)?$/.test(t.website)&&(s.website="Please enter a valid website URL"),t.address.trim()||(s.address="Business address is required"),c(s),Object.keys(s).length===0},C=()=>{const s={};return t.password?t.password.length<8&&(s.password="Password must be at least 8 characters"):s.password="Password is required",t.confirmPassword?t.password!==t.confirmPassword&&(s.confirmPassword="Passwords do not match"):s.confirmPassword="Please confirm your password",t.agreeToTerms||(s.agreeToTerms="You must agree to the terms and conditions"),c(s),Object.keys(s).length===0},j=()=>{let s=!1;switch(n){case 1:s=P();break;case 2:s=S();break;default:s=!1}s&&(g(n+1),window.scrollTo(0,0))},N=()=>{g(n-1),window.scrollTo(0,0)},T=s=>{var o,b,w;const r=((o=s==null?void 0:s.data)==null?void 0:o.token)||(s==null?void 0:s.token),d=((b=s==null?void 0:s.data)==null?void 0:b.user_id)||(s==null?void 0:s.userId),i=((w=s==null?void 0:s.data)==null?void 0:w.business_id)||(s==null?void 0:s.businessId);console.log("Saving user data:",{token:r,userId:d,businessId:i}),r?(localStorage.setItem("mpbh_token",r),(d||i)&&localStorage.setItem("mpbh_user",JSON.stringify({id:d,businessId:i})),console.log("Registration successful! Redirecting to dashboard..."),m.success("Registration successful! Redirecting to dashboard..."),setTimeout(()=>{p("/dashboard")},1500)):(console.warn("No token found in response:",s),console.log("Registration successful, but login required"),m.warning("Registration successful, but login required"),setTimeout(()=>{p("/login")},1500))},$=async s=>{if(s.preventDefault(),!!C()){f(!0),c({});try{const r={email:t.email,password:t.password,businessName:t.businessName,description:t.description,category:t.category,district:t.district,address:t.address,phone:t.phone,website:t.website||null};console.log("Attempting to register with data:",r);const d=m.loading("Registering your business...");try{const i=await fetch("/api/businesses/register",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(r)});if(m.dismiss(d),!i.ok)throw new Error(`Server responded with status: ${i.status}`);const o=await i.json();console.log("Registration successful:",o),m.success("Registration successful!"),T(o);return}catch(i){throw m.dismiss(d),console.error("Registration error:",i),m.error(i.message||"Registration failed. Please try again."),i}}catch(r){if(console.error("Registration error:",r),r.status===422&&r.data&&r.data.errors){const d={};Object.entries(r.data.errors).forEach(([i,o])=>{d[i]=Array.isArray(o)?o[0]:o}),c(d)}else r.status===409?c({email:"This email is already registered. Please use a different email or login."}):c({form:r.message||"Registration failed. Please try again."});window.scrollTo(0,0)}finally{f(!1)}}},R=()=>e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`rounded-full h-10 w-10 flex items-center justify-center ${n>=1?"bg-brand-black text-brand-white":"bg-brand-gray-200 text-brand-gray-600"}`,children:"1"}),e.jsx("div",{className:`ml-2 text-sm font-medium ${n>=1?"text-brand-black":"text-brand-gray-500"}`,children:"Business Details"})]}),e.jsx("div",{className:`flex-1 h-1 mx-4 ${n>=2?"bg-brand-black":"bg-brand-gray-200"}`}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`rounded-full h-10 w-10 flex items-center justify-center ${n>=2?"bg-brand-black text-brand-white":"bg-brand-gray-200 text-brand-gray-600"}`,children:"2"}),e.jsx("div",{className:`ml-2 text-sm font-medium ${n>=2?"text-brand-black":"text-brand-gray-500"}`,children:"Contact Info"})]}),e.jsx("div",{className:`flex-1 h-1 mx-4 ${n>=3?"bg-brand-black":"bg-brand-gray-200"}`}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`rounded-full h-10 w-10 flex items-center justify-center ${n>=3?"bg-brand-black text-brand-white":"bg-brand-gray-200 text-brand-gray-600"}`,children:"3"}),e.jsx("div",{className:`ml-2 text-sm font-medium ${n>=3?"text-brand-black":"text-brand-gray-500"}`,children:"Account Setup"})]})]}),B=()=>e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-bold mb-6",children:"Business Information"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"businessName",className:"block text-brand-black font-medium mb-1",children:"Business Name"}),e.jsx("input",{type:"text",id:"businessName",name:"businessName",className:`form-control ${a.businessName?"border-red-500":""}`,value:t.businessName,onChange:l,placeholder:"Your Business Name"}),a.businessName&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.businessName})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"category",className:"block text-brand-black font-medium mb-1",children:"Business Category"}),e.jsxs("select",{id:"category",name:"category",className:`form-control ${a.category?"border-red-500":""}`,value:t.category,onChange:l,children:[e.jsx("option",{value:"",children:"Select a category"}),v.map(s=>e.jsx("option",{value:s,children:s},s))]}),a.category&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.category})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"district",className:"block text-brand-black font-medium mb-1",children:"District"}),e.jsxs("select",{id:"district",name:"district",className:`form-control ${a.district?"border-red-500":""}`,value:t.district,onChange:l,children:[e.jsx("option",{value:"",children:"Select a district"}),k.map(s=>e.jsx("option",{value:s,children:s},s))]}),a.district&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.district})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"description",className:"block text-brand-black font-medium mb-1",children:"Business Description"}),e.jsx("textarea",{id:"description",name:"description",rows:"4",className:`form-control ${a.description?"border-red-500":""}`,value:t.description,onChange:l,placeholder:"Describe your business, services, and what makes you unique..."}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("p",{className:`text-sm ${t.description.length<50?"text-red-500":"text-gray-500"}`,children:"Minimum 50 characters"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.description.length,"/500"]})]}),a.description&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.description})]}),e.jsx("div",{className:"mt-8",children:e.jsx("button",{type:"button",className:"px-4 py-2 bg-brand-black text-brand-white font-medium rounded hover:bg-brand-gray-800 transition-colors w-full",onClick:j,children:"Continue to Contact Information"})})]}),F=()=>e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-bold mb-6",children:"Contact Information"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"phone",className:"block text-brand-black font-medium mb-1",children:"Phone Number"}),e.jsx("input",{type:"tel",id:"phone",name:"phone",className:`form-control ${a.phone?"border-red-500":""}`,value:t.phone,onChange:l,placeholder:"+27 12 345 6789"}),a.phone&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.phone})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"email",className:"block text-brand-black font-medium mb-1",children:"Email Address"}),e.jsx("input",{type:"email",id:"email",name:"email",className:`form-control ${a.email?"border-red-500":""}`,value:t.email,onChange:l,placeholder:"your@email.com"}),a.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.email})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"website",className:"block text-brand-black font-medium mb-1",children:"Website (Optional)"}),e.jsx("input",{type:"url",id:"website",name:"website",className:`form-control ${a.website?"border-red-500":""}`,value:t.website,onChange:l,placeholder:"https://www.yourbusiness.co.za"}),a.website&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.website})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"address",className:"block text-brand-black font-medium mb-1",children:"Business Address"}),e.jsx("textarea",{id:"address",name:"address",rows:"3",className:`form-control ${a.address?"border-red-500":""}`,value:t.address,onChange:l,placeholder:"123 Main Road, Nelspruit, Mpumalanga"}),a.address&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.address})]}),e.jsxs("div",{className:"mt-8 flex justify-between",children:[e.jsx("button",{type:"button",className:"btn btn-outline",onClick:N,children:"Back"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:j,children:"Continue to Account Setup"})]})]}),E=()=>e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-bold mb-6",children:"Create Your Account"}),a.form&&e.jsx("div",{className:"bg-red-50 text-red-800 p-4 rounded-md mb-6",children:a.form}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"password",className:"block text-brand-black font-medium mb-1",children:"Password"}),e.jsx("input",{type:"password",id:"password",name:"password",className:`form-control ${a.password?"border-red-500":""}`,value:t.password,onChange:l,placeholder:"u2022u2022u2022u2022u2022u2022u2022u2022"}),a.password&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.password}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Must be at least 8 characters"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-brand-black font-medium mb-1",children:"Confirm Password"}),e.jsx("input",{type:"password",id:"confirmPassword",name:"confirmPassword",className:`w-full p-2 border ${a.confirmPassword?"border-red-500":"border-brand-gray-300"} rounded focus:outline-none focus:ring-1 focus:ring-brand-black`,value:t.confirmPassword,onChange:l,placeholder:"u2022u2022u2022u2022u2022u2022u2022u2022"}),a.confirmPassword&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.confirmPassword})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{type:"checkbox",id:"agreeToTerms",name:"agreeToTerms",checked:t.agreeToTerms,onChange:l,className:"h-4 w-4 text-brand-black border-brand-gray-300 rounded focus:ring-brand-black"})}),e.jsxs("div",{className:"ml-3 text-sm",children:[e.jsxs("label",{htmlFor:"agreeToTerms",className:"text-brand-gray-700",children:["I agree to the ",e.jsx(h,{to:"/terms",className:"text-brand-black hover:text-brand-gray-600 border-b border-brand-gray-400",children:"Terms and Conditions"})," and ",e.jsx(h,{to:"/privacy",className:"text-brand-black hover:text-brand-gray-600 border-b border-brand-gray-400",children:"Privacy Policy"})]}),a.agreeToTerms&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.agreeToTerms})]})]})}),e.jsxs("div",{className:"mt-8 flex justify-between",children:[e.jsx("button",{type:"button",className:"btn btn-outline",onClick:N,children:"Back"}),e.jsx("button",{type:"submit",className:`px-4 py-2 bg-brand-black text-brand-white font-medium rounded hover:bg-brand-gray-800 transition-colors ${x?"opacity-75":""}`,disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 mr-3 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Registering..."]}):"Register Business"})]})]});return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"max-w-2xl mx-auto bg-brand-white rounded-lg shadow-md border border-brand-gray-200 overflow-hidden",children:e.jsxs("div",{className:"p-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-center mb-6",children:"Register Your Business"}),R(),e.jsxs("form",{onSubmit:$,children:[n===1&&B(),n===2&&F(),n===3&&E()]}),e.jsx("div",{className:"text-center mt-6",children:e.jsxs("p",{className:"text-brand-gray-600",children:["Already have an account?"," ",e.jsx(h,{to:"/login",className:"text-brand-black hover:text-brand-gray-600 border-b border-brand-gray-400 font-medium",children:"Login here"})]})})]})})})}export{L as default};
