import{j as e}from"./index-BTjPMemu.js";import{r as d,u as y,h as k,L as h}from"./vendor-BMRKNa3Q.js";import{V as l}from"./ui-BuAqC3bd.js";import"./sentry-CdN5cWpD.js";function S(){const[s,p]=d.useState({email:"",password:"",password_confirmation:"",token:""}),[o,i]=d.useState({}),[c,u]=d.useState(!1),[w,f]=d.useState(!1),x=y(),b=k();d.useEffect(()=>{const r=new URLSearchParams(b.search),a=r.get("token"),t=r.get("email");a&&t&&p(n=>({...n,email:decodeURIComponent(t),token:a}))},[b]);const m=r=>{const{name:a,value:t}=r.target;p(n=>({...n,[a]:t})),o[a]&&i(n=>({...n,[a]:""}))},g=()=>{const r={};return s.email?/\S+@\S+\.\S+/.test(s.email)||(r.email="Email is invalid"):r.email="Email is required",s.password?s.password.length<8&&(r.password="Password must be at least 8 characters"):r.password="Password is required",s.password_confirmation?s.password!==s.password_confirmation&&(r.password_confirmation="Passwords do not match"):r.password_confirmation="Please confirm your password",s.token||(r.token="Reset token is missing"),i(r),Object.keys(r).length===0},j=async r=>{if(r.preventDefault(),!!g()){u(!0);try{const a=l.loading("Resetting password...");await fetch("/api/password/reset",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(s)}).then(async t=>{if(l.dismiss(a),!t.ok){const n=await t.json();throw new Error(n.message||"Failed to reset password")}return t.json()}),l.success("Password has been reset successfully"),f(!0),setTimeout(()=>{x("/login")},3e3)}catch(a){console.error("Password reset error:",a),a.response&&a.response.status===422?a.response.data.errors?i(a.response.data.errors):i({form:"Invalid or expired password reset token"}):i({form:a.message||"Failed to reset password. Please try again."}),l.error("Failed to reset password")}finally{u(!1)}}};return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"max-w-md mx-auto bg-brand-white rounded-lg shadow-md border border-brand-gray-200 overflow-hidden",children:e.jsxs("div",{className:"p-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-center mb-6",children:"Reset Your Password"}),w?e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"bg-green-50 text-green-800 p-4 rounded-md mb-6",children:[e.jsx("p",{children:"Your password has been reset successfully!"}),e.jsx("p",{className:"mt-2",children:"You will be redirected to the login page shortly."})]}),e.jsx(h,{to:"/login",className:"inline-block px-4 py-2 bg-brand-black text-brand-white font-medium rounded hover:bg-brand-gray-800 transition-colors",children:"Go to Login"})]}):e.jsxs(e.Fragment,{children:[o.form&&e.jsx("div",{className:"bg-red-50 text-red-800 p-4 rounded-md mb-6",children:o.form}),!s.token&&e.jsx("div",{className:"bg-yellow-50 text-yellow-800 p-4 rounded-md mb-6",children:"Invalid or missing reset token. Please use the link from your email."}),e.jsxs("form",{onSubmit:j,children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"email",className:"block text-brand-black font-medium mb-1",children:"Email Address"}),e.jsx("input",{type:"email",id:"email",name:"email",className:`w-full p-2 border ${o.email?"border-red-500":"border-brand-gray-300"} rounded focus:outline-none focus:ring-1 focus:ring-brand-black`,value:s.email,onChange:m,placeholder:"youremail@example.com",readOnly:!!s.email}),o.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.email})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"password",className:"block text-brand-black font-medium mb-1",children:"New Password"}),e.jsx("input",{type:"password",id:"password",name:"password",className:`w-full p-2 border ${o.password?"border-red-500":"border-brand-gray-300"} rounded focus:outline-none focus:ring-1 focus:ring-brand-black`,value:s.password,onChange:m,placeholder:"••••••••"}),o.password&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.password})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"password_confirmation",className:"block text-brand-black font-medium mb-1",children:"Confirm New Password"}),e.jsx("input",{type:"password",id:"password_confirmation",name:"password_confirmation",className:`w-full p-2 border ${o.password_confirmation?"border-red-500":"border-brand-gray-300"} rounded focus:outline-none focus:ring-1 focus:ring-brand-black`,value:s.password_confirmation,onChange:m,placeholder:"••••••••"}),o.password_confirmation&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.password_confirmation})]}),e.jsx("input",{type:"hidden",name:"token",value:s.token}),e.jsx("button",{type:"submit",className:`px-4 py-2 bg-brand-black text-brand-white font-medium rounded hover:bg-brand-gray-800 transition-colors w-full ${c||!s.token?"opacity-75":""}`,disabled:c||!s.token,children:c?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin inline-block h-5 w-5 mr-3 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Resetting..."]}):"Reset Password"})]}),e.jsx("div",{className:"text-center mt-6",children:e.jsxs("p",{className:"text-brand-gray-600",children:["Remember your password?"," ",e.jsx(h,{to:"/login",className:"text-brand-black hover:text-brand-gray-600 border-b border-brand-gray-400 font-medium",children:"Back to Login"})]})})]})]})})})}export{S as default};
