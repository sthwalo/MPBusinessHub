import{j as e}from"./index-BTjPMemu.js";import{L as C,r as h,u as O,h as q,R as Y,c as B}from"./vendor-BMRKNa3Q.js";import{a as E}from"./index-t--hEgTQ.js";import{E as J}from"./ErrorMessage-3Fdeo-JS.js";import{p as F,a as I}from"./api-BFKBMowY.js";import{P as T}from"./index-D7k8otYo.js";import{V as z}from"./ui-BuAqC3bd.js";import{F as D,a as Q,b as K,c as X,d as Z,e as ee}from"./index.esm-CZ6LTzpv.js";import"./sentry-CdN5cWpD.js";function se({businessData:s}){var o,t,i,x,a,m,d,f,N;return e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6",children:["Welcome back to ",s.name]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Profile Views"}),e.jsx("h3",{className:"text-3xl font-bold mt-2",children:((o=s.statistics)==null?void 0:o.views)||0})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:e.jsxs("svg",{className:"h-6 w-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),e.jsx("div",{className:"mt-2 text-sm text-blue-600",children:"Last 30 days"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-100 rounded-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Contact Clicks"}),e.jsx("h3",{className:"text-3xl font-bold mt-2",children:((t=s.statistics)==null?void 0:t.contacts)||0})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:e.jsx("svg",{className:"h-6 w-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})})]}),e.jsx("div",{className:"mt-2 text-sm text-green-600",children:"+12% from last month"})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-100 rounded-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-600",children:"Reviews"}),e.jsx("h3",{className:"text-3xl font-bold mt-2",children:((i=s.statistics)==null?void 0:i.reviews)||0})]}),e.jsx("div",{className:"p-3 bg-yellow-100 rounded-full",children:e.jsx("svg",{className:"h-6 w-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})})})]}),e.jsxs("div",{className:"mt-2 text-sm text-yellow-600",children:["Average Rating: ",s.rating?s.rating.toFixed(1):"0.0","/5"]})]})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-6 mb-8",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Subscription Status"}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`inline-block w-3 h-3 rounded-full mr-2 ${((x=s.subscription)==null?void 0:x.status)==="active"?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{className:"font-medium",children:[s.package_type||"Basic"," Package"]}),((a=s.subscription)==null?void 0:a.status)==="active"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:"Active"}),((m=s.subscription)==null?void 0:m.status)==="inactive"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full",children:"Inactive"}),((d=s.subscription)==null?void 0:d.status)==="pending"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"Pending"})]}),e.jsx("p",{className:"text-gray-600 mt-1",children:(f=s.subscription)!=null&&f.amount?`${s.subscription.amount} / month`:"Free tier"}),e.jsx("p",{className:"text-gray-600 mt-1",children:(N=s.subscription)!=null&&N.next_billing_date?`Next billing date: ${new Date(s.subscription.next_billing_date).toLocaleDateString()}`:"No active subscription"})]}),e.jsx("div",{className:"mt-4 md:mt-0",children:e.jsx(C,{to:"/dashboard/upgrade",className:"btn btn-primary",children:"Upgrade Package"})})]})]}),e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs(C,{to:"/dashboard/profile",className:"border rounded-lg p-4 hover:bg-gray-50 flex items-center",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-full mr-4",children:e.jsx("svg",{className:"h-6 w-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Edit Profile"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Update your business information"})]})]}),(s.package_type==="Silver"||s.package_type==="Gold")&&e.jsxs(C,{to:"/dashboard/products",className:"border rounded-lg p-4 hover:bg-gray-50 flex items-center",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-full mr-4",children:e.jsx("svg",{className:"h-6 w-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Add Products"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Showcase your products and services"})]})]}),s.adverts_remaining>0&&e.jsxs(C,{to:"/dashboard/adverts",className:"border rounded-lg p-4 hover:bg-gray-50 flex items-center",children:[e.jsx("div",{className:"p-3 bg-yellow-100 rounded-full mr-4",children:e.jsx("svg",{className:"h-6 w-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Create Advert"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.adverts_remaining," adverts available"]})]})]}),e.jsxs(C,{to:`/business/${s.id}`,className:"border rounded-lg p-4 hover:bg-gray-50 flex items-center",children:[e.jsx("div",{className:"p-3 bg-purple-100 rounded-full mr-4",children:e.jsxs("svg",{className:"h-6 w-6 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"View Public Profile"}),e.jsx("p",{className:"text-sm text-gray-500",children:"See how customers view your listing"})]})]})]})]})}const A=({label:s,id:o,name:t,type:i="text",value:x,onChange:a,error:m,children:d})=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:o,className:"form-label",children:s}),d||e.jsx("input",{type:i,id:o,name:t,className:`form-control ${m?"border-red-500":""}`,value:x,onChange:a}),m&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:m})]}),H=({label:s,id:o,name:t,value:i,onChange:x,error:a,options:m})=>e.jsx(A,{label:s,id:o,name:t,value:i,onChange:x,error:a,children:e.jsxs("select",{id:o,name:t,className:`form-control ${a?"border-red-500":""}`,value:i,onChange:x,children:[e.jsxs("option",{value:"",children:["Select a ",s.toLowerCase()]}),m.map(d=>e.jsx("option",{value:d,children:d},d))]})}),V=({label:s,id:o,name:t,rows:i=3,value:x,onChange:a,error:m,minLength:d,maxLength:f})=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:o,className:"form-label",children:s}),e.jsx("textarea",{id:o,name:t,rows:i,className:`form-control ${m?"border-red-500":""}`,value:x,onChange:a}),d&&e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsxs("p",{className:`text-sm ${x.length<d?"text-red-500":"text-gray-500"}`,children:["Minimum ",d," characters"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[x.length,"/",f||1e3]})]}),m&&e.jsx("p",{className:"text-red-500 text-sm",children:m})]}),W=({title:s,children:o})=>e.jsxs("div",{className:"bg-brand-white border border-brand-gray-200 rounded-lg p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:s}),o]}),te=({message:s})=>s?e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 rounded-md p-4 mb-6",children:s}):null,re=({businessImage:s,onImageUpload:o})=>{const[t,i]=h.useState(s||""),[x,a]=h.useState(!1),[m,d]=h.useState(""),f=h.useRef(null),N=async S=>{const w=S.target.files[0];if(!w)return;const l=new FileReader;l.onload=()=>{i(l.result)},l.readAsDataURL(w),r(w)},r=async S=>{a(!0),d("");try{const w=new FormData;w.append("image",S);const l=localStorage.getItem("mpbh_token");if(!l)throw new Error("Authentication token not found");const c=await fetch("/api/images/business",{method:"POST",headers:{Authorization:`Bearer ${l}`},body:w});if(!c.ok){const u=await c.json();throw new Error(u.message||"Failed to upload image")}const n=await c.json();if(n.status==="success")o(n.image_url);else throw new Error(n.message||"Failed to upload image")}catch(w){d(w.message||"Failed to upload image"),console.error("Error uploading image:",w)}finally{a(!1)}},p=()=>{f.current.click()};return e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"form-label",children:"Business Profile Image"}),e.jsxs("div",{className:"mt-2 flex flex-col items-center",children:[e.jsxs("div",{className:"relative w-48 h-48 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center overflow-hidden bg-gray-50 cursor-pointer",onClick:p,children:[t?e.jsx("img",{src:t,alt:"Business profile",className:"w-full h-full object-cover"}):e.jsxs("div",{className:"text-center p-4",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Click to upload an image"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"JPG, PNG, GIF up to 2MB"})]}),x&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-white"})})]}),e.jsx("input",{type:"file",ref:f,className:"hidden",accept:"image/jpeg,image/png,image/gif",onChange:N}),m&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:m}),e.jsx("button",{type:"button",className:"mt-3 text-sm text-blue-600 hover:text-blue-800",onClick:p,children:t?"Change image":"Upload image"})]})]})},ae=({formData:s,handleChange:o,errors:t,categories:i,districts:x})=>e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(A,{label:"Business Name",id:"businessName",name:"businessName",value:s.businessName,onChange:o,error:t.businessName}),e.jsx(H,{label:"Business Category",id:"category",name:"category",value:s.category,onChange:o,error:t.category,options:i})]}),e.jsx("div",{className:"mt-6",children:e.jsx(H,{label:"District",id:"district",name:"district",value:s.district,onChange:o,error:t.district,options:x})}),e.jsx("div",{className:"mt-6",children:e.jsx(V,{label:"Business Description",id:"description",name:"description",rows:6,value:s.description,onChange:o,error:t.description,minLength:50,maxLength:1e3})})]}),ne=({formData:s,handleChange:o,errors:t})=>e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(A,{label:"Phone Number",id:"phone",name:"phone",type:"tel",value:s.phone,onChange:o,error:t.phone}),e.jsx(A,{label:"Email Address",id:"email",name:"email",type:"email",value:s.email,onChange:o,error:t.email})]}),e.jsx("div",{className:"mt-6",children:e.jsx(A,{label:"Website (Optional)",id:"website",name:"website",type:"url",value:s.website,onChange:o,error:t.website})}),e.jsx("div",{className:"mt-6",children:e.jsx(V,{label:"Business Address",id:"address",name:"address",rows:3,value:s.address,onChange:o,error:t.address})})]});function oe({businessData:s,updateBusinessData:o}){const[t,i]=h.useState({businessName:s.name,category:s.category,district:s.district,description:s.description||"",phone:s.phone||"",email:s.email||"",website:s.website||"",address:s.address||""}),[x,a]=h.useState({}),[m,d]=h.useState(!1),[f,N]=h.useState(""),[r,p]=h.useState(s.image_url||""),S=["Tourism","Agriculture","Construction","Events"],w=["Mbombela","Emalahleni","Bushbuckridge"],l=b=>{const{name:k,value:g}=b.target;i(j=>({...j,[k]:g})),x[k]&&a(j=>({...j,[k]:""})),f&&N("")},c=()=>{const b={};return t.businessName.trim()||(b.businessName="Business name is required"),t.category||(b.category="Please select a category"),t.district||(b.district="Please select a district"),t.description.trim()?t.description.length<50&&(b.description="Description should be at least 50 characters"):b.description="Business description is required",t.phone.trim()||(b.phone="Phone number is required"),t.email.trim()?/\S+@\S+\.\S+/.test(t.email)||(b.email="Please enter a valid email address"):b.email="Email is required",t.website&&!/^(https?:\/\/)?[\w-]+(\.[\w-]+)+(\/[\w-./?%&=]*)?$/.test(t.website)&&(b.website="Please enter a valid website URL"),t.address.trim()||(b.address="Business address is required"),a(b),Object.keys(b).length===0},n=async b=>{if(b.preventDefault(),!c()){window.scrollTo(0,0);return}d(!0);try{const k=await fetch("/api/business/update",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("mpbh_token")}`},body:JSON.stringify({businessName:t.businessName,category:t.category,district:t.district,description:t.description,phone:t.phone,email:t.email,website:t.website,address:t.address,image_url:r})});if(!k.ok){const j=await k.json();throw new Error(j.message||"Failed to update profile")}const g=await k.json();N(g.message||"Profile updated successfully!"),typeof o=="function"&&o(g.data),d(!1),window.scrollTo(0,0)}catch(k){a({form:k.message||"Failed to update profile. Please try again."}),d(!1),window.scrollTo(0,0)}},u=b=>{p(b)};return e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Business Profile"}),e.jsx(te,{message:f}),x.form&&e.jsx(J,{message:x.form}),e.jsxs("form",{onSubmit:n,children:[e.jsx("div",{className:"bg-brand-gray-100 border border-brand-gray-200 rounded-md p-4 mb-6",children:e.jsxs("p",{className:"text-brand-gray-700",children:[e.jsx("strong",{children:"Package Status:"})," ",s.package_type," Package",(s.package_type==="Basic"||s.package_type==="Bronze")&&e.jsxs("span",{className:"ml-2",children:[e.jsx("a",{href:"/dashboard/upgrade",className:"text-brand-black underline",children:"Upgrade"})," to unlock more features."]})]})}),e.jsx(re,{businessImage:r,onImageUpload:u}),e.jsx(W,{title:"Basic Information",children:e.jsx(ae,{formData:t,handleChange:l,errors:x,categories:S,districts:w})}),e.jsx(W,{title:"Contact Information",children:e.jsx(ne,{formData:t,handleChange:l,errors:x})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",className:`px-6 py-2 bg-brand-black text-brand-white rounded-md hover:bg-brand-gray-800 transition-colors ${m?"opacity-70 cursor-not-allowed":""}`,disabled:m,children:m?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 mr-3 text-brand-white inline",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving Changes..."]}):"Save Changes"})})]})]})}const le=({onSubmit:s,onCancel:o,initialData:t=null})=>{const[i,x]=h.useState({name:(t==null?void 0:t.name)||"",description:(t==null?void 0:t.description)||"",price:(t==null?void 0:t.price)||"",image_url:(t==null?void 0:t.image_url)||"",is_featured:(t==null?void 0:t.is_featured)||!1}),[a,m]=h.useState({}),d=r=>{const{name:p,value:S,type:w,checked:l}=r.target;x(c=>({...c,[p]:w==="checkbox"?l:S})),a[p]&&m(c=>({...c,[p]:""}))},f=()=>{const r={};return i.name.trim()||(r.name="Product name is required"),i.price&&isNaN(parseFloat(i.price))&&(r.price="Price must be a valid number"),m(r),Object.keys(r).length===0},N=r=>{r.preventDefault(),f()&&s(i)};return e.jsxs("div",{className:"bg-white border rounded-lg p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:t?"Edit Product":"Add New Product"}),e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"name",className:"form-label",children:"Product Name*"}),e.jsx("input",{type:"text",id:"name",name:"name",className:`form-control ${a.name?"border-red-500":""}`,value:i.name,onChange:d,placeholder:"e.g. Premium Service Package"}),a.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.name})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"description",className:"form-label",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",rows:"3",className:"form-control",value:i.description,onChange:d,placeholder:"Describe your product or service..."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"price",className:"form-label",children:"Price (R)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",id:"price",name:"price",className:`form-control ${a.price?"border-red-500":""}`,value:i.price,onChange:d,placeholder:"0.00"}),a.price&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.price})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"image_url",className:"form-label",children:"Image URL"}),e.jsx("input",{type:"text",id:"image_url",name:"image_url",className:"form-control",value:i.image_url,onChange:d,placeholder:"https://example.com/image.jpg"})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"is_featured",checked:i.is_featured,onChange:d,className:"mr-2"}),e.jsx("span",{children:"Featured Product"})]})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",className:"btn btn-outline",onClick:o,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:t?"Update Product":"Add Product"})]})]})]})},ie=({product:s,onEdit:o,onDelete:t})=>e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-bold",children:s.name}),s.is_featured&&e.jsx("span",{className:"ml-3 text-xs px-2 py-1 rounded-full bg-yellow-100 text-yellow-800",children:"Featured"})]}),e.jsx("p",{className:"text-gray-600 mb-2",children:s.description||"No description"}),s.price&&e.jsxs("p",{className:"font-bold mt-2",children:["R",parseFloat(s.price).toFixed(2)]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>o(s),className:"text-blue-600 hover:text-blue-800",title:"Edit product",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>t(s.id),className:"text-red-600 hover:text-red-800",title:"Delete product",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})});function de({businessData:s}){const[o,t]=h.useState([]),[i,x]=h.useState(!0),[a,m]=h.useState(!1),[d,f]=h.useState(null),[N,r]=h.useState({}),[p,S]=h.useState(""),w=s.package_type==="Silver"||s.package_type==="Gold";h.useEffect(()=>{l()},[]);const l=async()=>{try{x(!0);const g=await F.getAll();t(g.data||[])}catch(g){console.error("Error fetching products:",g),r({form:g.message||"Failed to load products"})}finally{x(!1)}},c=async g=>{try{const j=await F.create(g);t([...o,j.data]),S("Product created successfully!"),m(!1)}catch(j){console.error("Error creating product:",j),r({form:j.message||"Failed to create product"})}},n=async g=>{try{const j=await F.update(d.id,g);t(o.map(v=>v.id===d.id?j.data:v)),S("Product updated successfully!"),m(!1),f(null)}catch(j){console.error("Error updating product:",j),r({form:j.message||"Failed to update product"})}},u=async g=>{if(window.confirm("Are you sure you want to delete this product?"))try{await F.delete(g),t(o.filter(j=>j.id!==g)),S("Product deleted successfully!")}catch(j){console.error("Error deleting product:",j),r({form:j.message||"Failed to delete product"})}},b=g=>{f(g),m(!0)},k=()=>{m(!1),f(null)};return w?e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Products & Services"}),!a&&e.jsxs("button",{onClick:()=>m(!0),className:"btn btn-primary flex items-center",children:[e.jsx("svg",{className:"h-5 w-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add New Product"]})]}),p&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-800 rounded-md p-4 mb-6",children:p}),N.form&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-800 rounded-md p-4 mb-6",children:N.form}),a&&e.jsx(le,{onSubmit:d?n:c,onCancel:k,initialData:d}),i?e.jsxs("div",{className:"text-center py-10",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-3 text-gray-500",children:"Loading products..."})]}):o.length===0?e.jsxs("div",{className:"text-center py-10 bg-white border rounded-lg",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),e.jsx("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"No products yet"}),e.jsx("p",{className:"mt-1 text-gray-500",children:"Get started by adding your first product or service."}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:()=>m(!0),className:"btn btn-primary",children:"Add Product"})})]}):e.jsx("div",{className:"space-y-4",children:o.map(g=>e.jsx(ie,{product:g,onEdit:b,onDelete:u},g.id))})]}):e.jsxs("div",{className:"text-center py-10",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),e.jsx("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"Feature not available"}),e.jsx("p",{className:"mt-1 text-gray-500",children:"Products management is available for Silver and Gold packages only."}),e.jsx("div",{className:"mt-6",children:e.jsx(C,{to:"/dashboard/upgrade",className:"btn btn-primary",children:"Upgrade Your Package"})})]})}const ce=({onSubmit:s,onCancel:o,hasAdverts:t})=>{const[i,x]=h.useState({title:"",description:"",startDate:"",endDate:""}),[a,m]=h.useState({}),d=r=>{const{name:p,value:S}=r.target;x(w=>({...w,[p]:S})),a[p]&&m(w=>({...w,[p]:""}))},f=()=>{const r={};return i.title.trim()||(r.title="Advert title is required"),i.description.trim()||(r.description="Description is required"),i.startDate||(r.startDate="Start date is required"),i.endDate?new Date(i.endDate)<=new Date(i.startDate)&&(r.endDate="End date must be after start date"):r.endDate="End date is required",m(r),Object.keys(r).length===0},N=r=>{if(r.preventDefault(),!f())return;if(!t){m({form:"You have no adverts remaining. Please upgrade your package."});return}const p={...i,startDate:new Date(i.startDate).toISOString().split("T")[0],endDate:new Date(i.endDate).toISOString().split("T")[0]};s(p)};return e.jsxs("div",{className:"bg-white border rounded-lg p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Create New Advert"}),e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"title",className:"form-label",children:"Advert Title"}),e.jsx("input",{type:"text",id:"title",name:"title",className:`form-control ${a.title?"border-red-500":""}`,value:i.title,onChange:d,placeholder:"e.g. Summer Special Offer"}),a.title&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.title})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"description",className:"form-label",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",rows:"3",className:`form-control ${a.description?"border-red-500":""}`,value:i.description,onChange:d,placeholder:"Describe your advert..."}),a.description&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.description})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startDate",className:"form-label",children:"Start Date"}),e.jsx("input",{type:"date",id:"startDate",name:"startDate",className:`form-control ${a.startDate?"border-red-500":""}`,value:i.startDate,onChange:d,min:new Date().toISOString().split("T")[0]}),a.startDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.startDate})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"endDate",className:"form-label",children:"End Date"}),e.jsx("input",{type:"date",id:"endDate",name:"endDate",className:`form-control ${a.endDate?"border-red-500":""}`,value:i.endDate,onChange:d,min:i.startDate||new Date().toISOString().split("T")[0]}),a.endDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.endDate})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",className:"btn btn-outline",onClick:o,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:!t,children:"Create Advert"})]})]})]})},me=({advert:s,onDelete:o})=>e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-bold",children:s.title}),e.jsx("span",{className:`ml-3 text-xs px-2 py-1 rounded-full ${s.status==="active"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:s.status==="active"?"Active":"Scheduled"})]}),e.jsx("p",{className:"text-gray-600 mb-2",children:s.description}),e.jsxs("div",{className:"text-sm text-gray-500",children:["From ",new Date(s.start_date||s.startDate).toLocaleDateString()," to ",new Date(s.end_date||s.endDate).toLocaleDateString()]})]}),e.jsx("button",{onClick:()=>o(s.id),className:"text-red-600 hover:text-red-800",title:"Delete advert",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})});function he({businessData:s}){const[o,t]=h.useState([]),[i,x]=h.useState(!0),[a,m]=h.useState(!1),[d,f]=h.useState({}),[N,r]=h.useState(""),p=s.adverts_remaining>0,S=s.package_type==="Silver"||s.package_type==="Gold";h.useEffect(()=>{w()},[]);const w=async()=>{try{x(!0);const n=await I.getAll();t(n.data||[])}catch(n){console.error("Error fetching adverts:",n),f({form:n.message||"Failed to load adverts"})}finally{x(!1)}},l=async n=>{try{const u=await I.create(n);t([...o,u.data]),s.adverts_remaining-=1,r("Advert created successfully!"),m(!1)}catch(u){console.error("Error creating advert:",u),f({form:u.message||"Failed to create advert"})}},c=async n=>{if(window.confirm("Are you sure you want to delete this advert?"))try{await I.delete(n),t(o.filter(u=>u.id!==n)),r("Advert deleted successfully!")}catch(u){console.error("Error deleting advert:",u),f({form:u.message||"Failed to delete advert"})}};return S?e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Adverts Management"}),!a&&p&&e.jsxs("button",{onClick:()=>m(!0),className:"btn btn-primary flex items-center",children:[e.jsx("svg",{className:"h-5 w-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Create New Advert"]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-6 w-6 text-blue-600 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.adverts_remaining," ",s.adverts_remaining===2?"advert":"adverts"," remaining this month"]}),e.jsx("p",{className:"text-sm text-blue-600",children:s.package_type==="Silver"?"2 adverts per month with Silver package":"4 adverts per month with Gold package"})]})]})}),N&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-800 rounded-md p-4 mb-6",children:N}),d.form&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-800 rounded-md p-4 mb-6",children:d.form}),a&&e.jsx(ce,{onSubmit:l,onCancel:()=>m(!1),hasAdverts:p}),i?e.jsxs("div",{className:"text-center py-10",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-3 text-gray-500",children:"Loading adverts..."})]}):o.length===0?e.jsxs("div",{className:"text-center py-10 bg-white border rounded-lg",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"})}),e.jsx("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"No adverts yet"}),e.jsx("p",{className:"mt-1 text-gray-500",children:"Get started by creating your first advert to promote your business."}),p?e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:()=>m(!0),className:"btn btn-primary",children:"Create Advert"})}):e.jsx("div",{className:"mt-6",children:e.jsx(C,{to:"/dashboard/upgrade",className:"btn btn-primary",children:"Upgrade For More Adverts"})})]}):e.jsx("div",{className:"space-y-4",children:o.map(n=>e.jsx(me,{advert:n,onDelete:c},n.id))})]}):e.jsxs("div",{className:"text-center py-10",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"})}),e.jsx("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"Feature not available"}),e.jsx("p",{className:"mt-1 text-gray-500",children:"Adverts are available for Silver and Gold packages only."}),e.jsx("div",{className:"mt-6",children:e.jsx(C,{to:"/dashboard/upgrade",className:"btn btn-primary",children:"Upgrade Your Package"})})]})}function U({children:s,onClose:o}){return h.useEffect(()=>{const t=i=>{i.key==="Escape"&&o()};return document.addEventListener("keydown",t),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",t),document.body.style.overflow="unset"}},[o]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:o}),e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:e.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[e.jsx("button",{onClick:o,className:"absolute right-4 top-4 text-gray-400 hover:text-gray-500",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s]})})})]})}U.propTypes={children:T.node.isRequired,onClose:T.func.isRequired};function xe({businessData:s}){const[o,t]=h.useState([]),[i,x]=h.useState(!0),[a,m]=h.useState(null),[d,f]=h.useState(!1),[N,r]=h.useState(null);h.useEffect(()=>{p()},[]);const p=async()=>{try{const n=await fetch("/api/invoices",{headers:{Authorization:`Bearer ${localStorage.getItem("mpbh_token")}`}});if(!n.ok)throw new Error("Failed to fetch payment history");const u=await n.json();t(u.data)}catch(n){console.error("Error:",n),r(n.message)}finally{x(!1)}},S=async n=>{try{const u=await fetch(`/api/invoices/${n}/download`,{headers:{Authorization:`Bearer ${localStorage.getItem("mpbh_token")}`}});if(!u.ok)throw new Error("Failed to download invoice");const b=await u.blob(),k=window.URL.createObjectURL(b),g=document.createElement("a");g.href=k,g.setAttribute("download",`invoice-${n}.pdf`),document.body.appendChild(g),g.click(),g.remove(),window.URL.revokeObjectURL(k)}catch(u){console.error("Error downloading invoice:",u)}},w=async n=>{try{const u=await fetch(`/api/invoices/${n}`,{headers:{Authorization:`Bearer ${localStorage.getItem("mpbh_token")}`}});if(!u.ok)throw new Error("Failed to fetch invoice details");const b=await u.json();m(b),f(!0)}catch(u){console.error("Error:",u),r(u.message)}},l=async n=>{try{if(!(await fetch(`/api/invoices/${n}/send`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("mpbh_token")}`}})).ok)throw new Error("Failed to send invoice");alert("Invoice sent successfully")}catch(u){console.error("Error:",u),r(u.message)}},c=n=>{switch(n){case"paid":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Payment History"}),e.jsxs("div",{className:"bg-white border rounded-lg p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Current Subscription"}),e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-lg font-medium",children:[e.jsx("span",{className:`inline-block w-3 h-3 rounded-full mr-2 ${s.subscription.status==="active"?"bg-green-500":"bg-red-500"}`}),s.package_type," Package - R",s.subscription.amount,"/month"]}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Next billing date: ",new Date(s.subscription.next_billing_date).toLocaleDateString()]})]}),e.jsx("div",{className:"mt-4 md:mt-0",children:e.jsx("button",{className:"btn btn-outline",children:"Download Invoice"})})]})]}),e.jsxs("div",{className:"bg-white border rounded-lg overflow-hidden",children:[e.jsx("h3",{className:"text-lg font-bold p-6 border-b",children:"Transaction History"}),i?e.jsxs("div",{className:"text-center py-10",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-3 text-gray-500",children:"Loading payment history..."})]}):o.length===0?e.jsxs("div",{className:"text-center py-10",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"No payment history yet"}),e.jsx("p",{className:"mt-1 text-gray-500",children:"Your payment history will appear here once you make a payment."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Invoice #"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Package"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.map(n=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:n.id}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(n.date).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:n.package}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["R",n.amount.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${c(n.status)}`,children:n.status.charAt(0).toUpperCase()+n.status.slice(1)})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[e.jsx("button",{onClick:()=>w(n.id),className:"text-blue-600 hover:text-blue-800 mr-3",children:e.jsxs("span",{className:"flex items-center",children:[e.jsxs("svg",{className:"h-4 w-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"View"]})}),e.jsx("button",{onClick:()=>S(n.id),className:"text-blue-600 hover:text-blue-800 mr-3",children:e.jsxs("span",{className:"flex items-center",children:[e.jsx("svg",{className:"h-4 w-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]})}),e.jsx("button",{onClick:()=>l(n.id),className:"text-blue-600 hover:text-blue-800",children:e.jsxs("span",{className:"flex items-center",children:[e.jsx("svg",{className:"h-4 w-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),"Email"]})})]})]},n.id))})]})})]}),e.jsxs("div",{className:"mt-8 bg-white border rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Payment Methods"}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-md bg-gray-50",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-md mr-4",children:e.jsx("svg",{className:"h-6 w-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"PayFast"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Auto-renewing monthly"})]})]}),e.jsx("button",{className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Update Payment Method"})]})]}),d&&a&&e.jsx(U,{onClose:()=>f(!1),children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Invoice Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Invoice Number"}),e.jsx("p",{children:a.invoice_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Business Name"}),e.jsx("p",{children:a.business.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Amount"}),e.jsxs("p",{children:["R",a.amount.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Status"}),e.jsx("p",{className:`inline-flex px-2 text-xs font-semibold rounded-full ${c(a.status)}`,children:a.status})]}),a.payment&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Payment Method"}),e.jsx("p",{children:a.payment.payment_method})]})]})]})}),N&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded relative",role:"alert",children:e.jsx("span",{className:"block sm:inline",children:N})})]})}function ue({businessData:s,onUpgrade:o}){const[t,i]=h.useState(s.package_type),[x,a]=h.useState("monthly"),[m,d]=h.useState(!1),[f,N]=h.useState(""),[r,p]=h.useState(""),[S,w]=h.useState([]);h.useEffect(()=>{(async()=>{try{const P=await(await fetch("/api/packages")).json();P.status==="success"&&w(P.data)}catch(_){console.error("Error fetching packages:",_),p("Failed to load packages. Please try again later.")}})()},[]);const l=[{id:1,name:"Basic",price_monthly:0,price_annual:0,advert_limit:0,product_limit:0,features:["Basic listing","Business hours"]},{id:2,name:"Bronze",price_monthly:200,price_annual:2e3,advert_limit:0,product_limit:0,features:["Basic listing","Business hours","Contact information"]},{id:3,name:"Silver",price_monthly:500,price_annual:5e3,advert_limit:2,product_limit:10,features:["Basic listing","Business hours","Contact information","Products showcase","2 monthly adverts"]},{id:4,name:"Gold",price_monthly:1e3,price_annual:1e4,advert_limit:4,product_limit:50,features:["Basic listing","Business hours","Contact information","Products showcase","4 monthly adverts","Featured listing"]}],c=S.length>0?S:l,n=c.map(y=>({id:y.id,name:y.name,monthlyPrice:y.price_monthly,annualPrice:y.price_annual,price_monthly:y.price_monthly,price_annual:y.price_annual,popular:y.name==="Silver",features:[{name:"Listing Visibility",included:!0},{name:"Contact Links",included:["Bronze","Silver","Gold"].includes(y.name)},{name:"E-Commerce",included:["Silver","Gold"].includes(y.name)},{name:"Monthly Adverts",included:y.advert_limit>0,details:y.advert_limit.toString()}]})),u=y=>{const _=c.find(P=>P.id===y);_&&(i(_.name),N(""),p(""))},b=y=>{a(y),N(""),p("")},k=()=>17,g=()=>n.findIndex(y=>y.name===s.package_type),j=()=>n.findIndex(y=>y.name===t),v=()=>j()>g(),L=()=>t===s.package_type,R=async y=>{if(y.preventDefault(),!L()){d(!0),p(""),N("");try{const _=c.find(G=>G.name===t);if(!_)throw new Error("Selected package not found");const P=await fetch("/api/packages/upgrade",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("mpbh_token")}`},body:JSON.stringify({package_id:_.id,billing_cycle:x})}),M=await P.json();if(!P.ok)throw new Error(M.message||"Failed to upgrade package");const $={...s,package_id:M.data.business.package_id,package_type:_.name,adverts_remaining:M.data.business.adverts_remaining,billing_cycle:M.data.business.billing_cycle,subscription_ends_at:M.data.business.subscription_ends_at,subscription:{...s.subscription,amount:x==="monthly"?_.price_monthly:_.price_annual/12}};typeof o=="function"&&o($),N(`Successfully ${v()?"upgraded":"changed"} to ${t} plan!`)}catch(_){console.error("Error upgrading package:",_),p(_.message||"An error occurred while upgrading your package")}finally{d(!1)}}};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold font-serif text-brand-black mb-2",children:"Upgrade Your Package"}),e.jsx("p",{className:"text-brand-gray-600",children:"Choose the right plan for your business needs"})]}),f&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-800 rounded-lg p-4 mb-6",children:f}),r&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-800 rounded-lg p-4 mb-6",children:r}),e.jsxs("div",{className:"bg-brand-white rounded-lg shadow-brand-md p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-bold font-serif text-brand-black mb-4",children:"Billing Cycle"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:()=>b("monthly"),className:`px-4 py-2 rounded-md ${x==="monthly"?"bg-brand-black text-brand-white":"bg-brand-gray-100 text-brand-gray-700 hover:bg-brand-gray-200"}`,children:"Monthly"}),e.jsxs("button",{onClick:()=>b("annual"),className:`px-4 py-2 rounded-md ${x==="annual"?"bg-brand-black text-brand-white":"bg-brand-gray-100 text-brand-gray-700 hover:bg-brand-gray-200"}`,children:["Annual ",e.jsxs("span",{className:"text-green-600 text-xs font-bold ml-1",children:["Save ",k(),"%"]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:n.map(y=>{const _=y.name===s.package_type,P=y.name===t;return e.jsxs("div",{className:`rounded-lg overflow-hidden border ${P?"border-brand-black shadow-brand-md":"border-brand-gray-200 shadow-brand-sm"} 
                ${y.popular?"relative":""}`,children:[y.popular&&e.jsx("div",{className:"absolute top-0 right-0 bg-brand-black text-brand-white text-xs font-bold uppercase py-1 px-3 rounded-bl-lg",children:"Popular"}),e.jsxs("div",{className:"p-6 bg-brand-white",children:[e.jsx("h3",{className:"text-xl font-bold font-serif text-brand-black mb-2",children:y.name}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-baseline",children:[e.jsxs("span",{className:"text-3xl font-bold text-brand-black",children:["R",x==="monthly"?y.monthlyPrice:Math.round(y.annualPrice/12)]}),e.jsx("span",{className:"text-brand-gray-500 ml-1",children:"/mo"})]}),x==="annual"&&y.annualPrice>0&&e.jsxs("div",{className:"text-sm text-green-600 mt-1",children:["R",y.annualPrice," billed annually",e.jsx("br",{}),e.jsxs("span",{className:"font-medium",children:["Save R",(y.monthlyPrice*12-y.annualPrice).toLocaleString()]})]})]}),e.jsx("ul",{className:"space-y-3 mb-6",children:y.features.map((M,$)=>e.jsxs("li",{className:"flex items-start",children:[M.included?e.jsx("svg",{className:"h-5 w-5 text-green-500 mt-0.5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}):e.jsx("svg",{className:"h-5 w-5 text-red-500 mt-0.5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})}),e.jsxs("span",{className:"text-brand-gray-700",children:[M.name,M.details&&e.jsxs("span",{className:"text-brand-gray-500 ml-1",children:["(",M.details,")"]})]})]},$))}),e.jsx("button",{onClick:()=>u(y.id),className:`w-full py-2 px-4 rounded-md transition-colors ${P?"bg-brand-black text-brand-white":"border border-brand-black text-brand-black hover:bg-brand-gray-100"}`,disabled:_&&P,children:_?"Current Plan":P?"Selected":"Select"})]})]},y.id)})}),e.jsx("div",{className:"bg-brand-gray-100 border border-brand-gray-200 rounded-lg p-6 shadow-brand-sm",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center",children:[e.jsxs("div",{className:"mb-4 md:mb-0",children:[e.jsx("h3",{className:"text-lg font-bold font-serif text-brand-black",children:L()?"You are on this plan already":v()?`Upgrade to ${t} Package`:`Change to ${t} Package`}),e.jsx("p",{className:"text-brand-gray-600",children:L()?"You can choose another plan to upgrade or downgrade":v()?"Get more features and benefits":"You will lose some features but pay less"})]}),e.jsx("button",{onClick:R,disabled:L()||m,className:`px-6 py-3 rounded-md transition-colors ${L()?"bg-brand-gray-300 text-brand-gray-700 cursor-not-allowed":v()?"bg-brand-black text-brand-white hover:bg-brand-gray-800":"border border-brand-black text-brand-black hover:bg-brand-gray-100"} ${m?"opacity-75 cursor-wait":""}`,children:m?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 mr-3 inline-block",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):L()?"Current Plan":v()?"Upgrade Now":"Change Plan"})]})})]})}const pe=()=>{const[s,o]=h.useState([]),[t,i]=h.useState(!0),[x,a]=h.useState(null),m=O(),d=async()=>{try{i(!0);const r=localStorage.getItem("mpbh_token");if(!r){m("/login");return}const p=await E.get("/api/sessions",{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json",Accept:"application/json"}});o(p.data.sessions),a(null)}catch(r){a("Failed to load sessions. Please try again."),console.error(r)}finally{i(!1)}};h.useEffect(()=>{d()},[]);const f=async r=>{try{const p=localStorage.getItem("mpbh_token");if(!p){m("/login");return}await E.delete(`/api/sessions/${r}`,{headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json",Accept:"application/json"}}),d()}catch(p){a("Failed to revoke session. Please try again."),console.error(p)}},N=async()=>{try{const r=localStorage.getItem("mpbh_token");if(!r){m("/login");return}await E.delete("/api/sessions",{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json",Accept:"application/json"}}),d()}catch(r){a("Failed to revoke all sessions. Please try again."),console.error(r)}};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Manage Your Sessions"}),x&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:x}),e.jsx("div",{className:"mb-4",children:e.jsx("button",{onClick:N,className:"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded",children:"Sign Out From All Other Devices"})}),t?e.jsx("p",{children:"Loading sessions..."}):e.jsx("div",{className:"bg-white shadow-md rounded my-6",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200 text-gray-600 uppercase text-sm leading-normal",children:[e.jsx("th",{className:"py-3 px-6 text-left",children:"Device"}),e.jsx("th",{className:"py-3 px-6 text-left",children:"IP Address"}),e.jsx("th",{className:"py-3 px-6 text-left",children:"Last Active"}),e.jsx("th",{className:"py-3 px-6 text-left",children:"Created"}),e.jsx("th",{className:"py-3 px-6 text-left",children:"Expires"}),e.jsx("th",{className:"py-3 px-6 text-center",children:"Actions"})]})}),e.jsx("tbody",{className:"text-gray-600 text-sm",children:s.map(r=>e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-100",children:[e.jsxs("td",{className:"py-3 px-6 text-left",children:[r.device,r.is_current_device&&e.jsx("span",{className:"ml-2 bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded",children:"Current"})]}),e.jsx("td",{className:"py-3 px-6 text-left",children:r.ip_address}),e.jsx("td",{className:"py-3 px-6 text-left",children:r.last_active}),e.jsx("td",{className:"py-3 px-6 text-left",children:r.created_at}),e.jsx("td",{className:"py-3 px-6 text-left",children:r.expires_at}),e.jsx("td",{className:"py-3 px-6 text-center",children:!r.is_current_device&&e.jsx("button",{onClick:()=>f(r.id),className:"bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-3 rounded text-xs",children:"Sign Out"})})]},r.id))})]})})]})};function ge({businessData:s,updateBusinessData:o}){const t=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],[i,x]=h.useState({}),[a,m]=h.useState(!1),[d,f]=h.useState({});h.useEffect(()=>{const l={};t.forEach(c=>{s.operatingHours&&s.operatingHours[c]?l[c]={isClosed:s.operatingHours[c]==="Closed",openingTime:s.operatingHours[c]!=="Closed"?s.operatingHours[c].split(" - ")[0]:"09:00",closingTime:s.operatingHours[c]!=="Closed"?s.operatingHours[c].split(" - ")[1]:"17:00"}:l[c]={isClosed:!1,openingTime:"09:00",closingTime:"17:00"}}),x(l)},[s]);const N=l=>{x(c=>({...c,[l]:{...c[l],isClosed:!c[l].isClosed}}))},r=(l,c,n)=>{x(u=>({...u,[l]:{...u[l],[c]:n}}))},p=()=>{const l={};return Object.entries(i).forEach(([c,n])=>{if(!n.isClosed){const u=/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;if(u.test(n.openingTime)||(l[`${c}_opening`]="Invalid time format (use HH:MM)"),u.test(n.closingTime)||(l[`${c}_closing`]="Invalid time format (use HH:MM)"),u.test(n.openingTime)&&u.test(n.closingTime)){const b=n.openingTime.split(":").map(Number),k=n.closingTime.split(":").map(Number);(b[0]>k[0]||b[0]===k[0]&&b[1]>=k[1])&&(l[`${c}_range`]="Opening time must be before closing time")}}}),f(l),Object.keys(l).length===0},S=()=>{const l={};return Object.entries(i).forEach(([c,n])=>{n.isClosed?l[c]="Closed":l[c]=`${n.openingTime} - ${n.closingTime}`}),l},w=async l=>{if(l.preventDefault(),!p()){z.error("Please fix the errors in your operating hours");return}m(!0);try{const c=localStorage.getItem("mpbh_token");if(!c)throw new Error("Authentication token not found");const n=S(),u=await fetch("/api/business/update",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({businessName:s.name,category:s.category,district:s.district,description:s.description,phone:s.phone,email:s.email,website:s.website||"",address:s.address,operatingHours:n})});if(!u.ok){const k=await u.json();throw new Error(k.message||"Failed to update operating hours")}const b=await u.json();if(b.status==="success")z.success("Operating hours updated successfully!"),typeof o=="function"&&o({...s,operatingHours:n});else throw new Error(b.message||"Failed to update operating hours")}catch(c){console.error("Error updating operating hours:",c),z.error(c.message||"An error occurred while updating operating hours")}finally{m(!1)}};return e.jsxs("div",{className:"bg-brand-white border border-brand-gray-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Business Hours"}),Object.keys(i).length===0?e.jsx("div",{className:"flex justify-center items-center h-40",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-brand-black"})}):e.jsxs("form",{onSubmit:w,children:[e.jsx("div",{className:"space-y-6",children:t.map(l=>e.jsxs("div",{className:"border-b border-brand-gray-200 pb-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"capitalize font-medium text-lg mr-4",children:l}),e.jsxs("div",{className:"relative inline-block w-12 mr-2 align-middle select-none",children:[e.jsx("input",{type:"checkbox",id:`toggle-${l}`,checked:!i[l].isClosed,onChange:()=>N(l),className:"sr-only"}),e.jsx("label",{htmlFor:`toggle-${l}`,className:`block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer ${i[l].isClosed?"":"bg-brand-black"}`,children:e.jsx("span",{className:`dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition-transform duration-300 ease-in-out ${i[l].isClosed?"":"transform translate-x-6"}`})})]}),e.jsx("span",{className:"text-sm text-brand-gray-600 ml-2",children:i[l].isClosed?"Closed":"Open"})]})}),!i[l].isClosed&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:`opening-${l}`,className:"block text-sm font-medium text-brand-gray-700 mb-1",children:"Opening Time"}),e.jsx("input",{type:"time",id:`opening-${l}`,value:i[l].openingTime,onChange:c=>r(l,"openingTime",c.target.value),className:"w-full p-2 border border-brand-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-black"}),d[`${l}_opening`]&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:d[`${l}_opening`]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`closing-${l}`,className:"block text-sm font-medium text-brand-gray-700 mb-1",children:"Closing Time"}),e.jsx("input",{type:"time",id:`closing-${l}`,value:i[l].closingTime,onChange:c=>r(l,"closingTime",c.target.value),className:"w-full p-2 border border-brand-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-black"}),d[`${l}_closing`]&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:d[`${l}_closing`]})]}),d[`${l}_range`]&&e.jsx("p",{className:"text-red-500 text-xs mt-1 col-span-2",children:d[`${l}_range`]})]})]},l))}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{type:"submit",className:`px-6 py-2 bg-brand-black text-brand-white rounded-md hover:bg-brand-gray-800 transition-colors ${a?"opacity-70 cursor-not-allowed":""}`,disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 mr-3 inline-block",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):"Save Hours"})})]})]})}function be({businessData:s,onUpdate:o}){const[t,i]=h.useState({facebook:"",instagram:"",twitter:"",linkedin:"",youtube:"",tiktok:""}),[x,a]=h.useState(!1),[m,d]=h.useState(""),[f,N]=h.useState(""),[r,p]=h.useState({platform:"facebook",content:"",image:null});h.useEffect(()=>{s.social_media&&i(s.social_media)},[s]);const S=k=>{const{name:g,value:j}=k.target;i(v=>({...v,[g]:j}))},w=k=>{const{name:g,value:j}=k.target;p(v=>({...v,[g]:j}))},l=k=>{p(g=>({...g,image:k.target.files[0]}))},c=async k=>{k.preventDefault(),a(!0),d(""),N("");try{const g=localStorage.getItem("mpbh_token"),j=await fetch("/api/business/social-media",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`,Accept:"application/json"},body:JSON.stringify(t)}),v=await j.json();j.ok?(N("Social media links updated successfully"),o&&o(v.data)):d(v.message||"Failed to update social media links")}catch(g){d("An error occurred. Please try again."),console.error(g)}finally{a(!1)}},n=async k=>{k.preventDefault(),a(!0),d(""),N("");try{const g=localStorage.getItem("mpbh_token"),j=new FormData;j.append("platform",r.platform),j.append("content",r.content),r.image&&j.append("image",r.image);const v=await fetch("/api/business/social-media/feature",{method:"POST",headers:{Authorization:`Bearer ${g}`,Accept:"application/json"},body:j}),L=await v.json();v.ok?(N("Social media feature post created successfully"),p({platform:"facebook",content:"",image:null}),o&&o({...s,social_features_remaining:L.remaining_features})):d(L.message||"Failed to create social media feature post")}catch(g){d("An error occurred. Please try again."),console.error(g)}finally{a(!1)}},u=["Bronze","Silver","Gold"].includes(s.package_type),b=s.package_type==="Gold"&&s.social_features_remaining>0;return u?e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Social Media Management"}),m&&e.jsx("div",{className:"bg-red-50 p-4 rounded border border-red-200 mb-4",children:e.jsx("p",{className:"text-red-700",children:m})}),f&&e.jsx("div",{className:"bg-green-50 p-4 rounded border border-green-200 mb-4",children:e.jsx("p",{className:"text-green-700",children:f})}),e.jsxs("form",{onSubmit:c,className:"mb-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-1 font-medium flex items-center",children:[e.jsx(D,{className:"mr-2 text-blue-600"})," Facebook"]}),e.jsx("input",{type:"url",name:"facebook",value:t.facebook||"",onChange:S,placeholder:"https://facebook.com/yourbusiness",className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-1 font-medium flex items-center",children:[e.jsx(Q,{className:"mr-2 text-pink-600"})," Instagram"]}),e.jsx("input",{type:"url",name:"instagram",value:t.instagram||"",onChange:S,placeholder:"https://instagram.com/yourbusiness",className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-1 font-medium flex items-center",children:[e.jsx(K,{className:"mr-2 text-blue-400"})," Twitter"]}),e.jsx("input",{type:"url",name:"twitter",value:t.twitter||"",onChange:S,placeholder:"https://twitter.com/yourbusiness",className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-1 font-medium flex items-center",children:[e.jsx(X,{className:"mr-2 text-blue-700"})," LinkedIn"]}),e.jsx("input",{type:"url",name:"linkedin",value:t.linkedin||"",onChange:S,placeholder:"https://linkedin.com/company/yourbusiness",className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-1 font-medium flex items-center",children:[e.jsx(Z,{className:"mr-2 text-red-600"})," YouTube"]}),e.jsx("input",{type:"url",name:"youtube",value:t.youtube||"",onChange:S,placeholder:"https://youtube.com/c/yourbusiness",className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-1 font-medium flex items-center",children:[e.jsx(ee,{className:"mr-2"})," TikTok"]}),e.jsx("input",{type:"url",name:"tiktok",value:t.tiktok||"",onChange:S,placeholder:"https://tiktok.com/@yourbusiness",className:"w-full p-2 border rounded"})]})]}),e.jsx("button",{type:"submit",disabled:x,className:"px-4 py-2 bg-brand-primary text-white rounded hover:bg-brand-primary-dark transition-colors disabled:opacity-50",children:x?"Saving...":"Save Social Links"})]}),b&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 mt-8",children:"Create Social Media Feature Post"}),e.jsx("div",{className:"bg-blue-50 p-4 rounded border border-blue-200 mb-4",children:e.jsxs("p",{className:"text-blue-700",children:["As a Gold tier member, you can create ",s.social_features_remaining," more featured social media post",s.social_features_remaining!==1?"s":""," this month."]})}),e.jsxs("form",{onSubmit:n,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Platform"}),e.jsxs("select",{name:"platform",value:r.platform,onChange:w,className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"facebook",children:"Facebook"}),e.jsx("option",{value:"instagram",children:"Instagram"}),e.jsx("option",{value:"twitter",children:"Twitter"}),e.jsx("option",{value:"linkedin",children:"LinkedIn"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Content"}),e.jsx("textarea",{name:"content",value:r.content,onChange:w,placeholder:"Write your post content here...",className:"w-full p-2 border rounded h-32",maxLength:500}),e.jsxs("p",{className:"text-xs text-right text-gray-500",children:[r.content.length,"/500 characters"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Image (optional)"}),e.jsx("input",{type:"file",name:"image",onChange:l,accept:"image/*",className:"w-full p-2 border rounded"})]}),e.jsx("button",{type:"submit",disabled:x,className:"px-4 py-2 bg-brand-primary text-white rounded hover:bg-brand-primary-dark transition-colors disabled:opacity-50",children:x?"Creating...":"Create Feature Post"})]})]})]}):e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Social Media Management"}),e.jsx("div",{className:"bg-yellow-50 p-4 rounded border border-yellow-200",children:e.jsxs("p",{className:"text-yellow-700",children:["Social media links are available with Bronze package and higher.",e.jsx("a",{href:"/dashboard/upgrade",className:"text-blue-600 ml-2 font-medium",children:"Upgrade now"})]})})]})}function _e(){const[s,o]=h.useState(null),[t,i]=h.useState(!0),[x,a]=h.useState(!1),m=O(),d=q(),[f,N]=h.useState(!1),r=c=>d.pathname===c||d.pathname===c+"/",p=c=>{o(n=>({...n,...c})),localStorage.setItem("simulatedBusinessData",JSON.stringify(prevData))};window.updateBusinessData=p;const S=c=>{localStorage.setItem("simulatedBusinessData",JSON.stringify(c)),o(n=>({...n,...c,subscription:{...n.subscription,...c.subscription,status:"active"}}))};h.useEffect(()=>{(async()=>{var n,u;try{const b=localStorage.getItem("simulatedBusinessData");if(b){o(JSON.parse(b));return}const k=localStorage.getItem("mpbh_token");if(!k){m("/login");return}(async()=>{try{(await E.get("/api/user/role",{headers:{Authorization:`Bearer ${localStorage.getItem("mpbh_token")}`}})).data.role==="admin"&&N(!0)}catch(L){console.error("Error checking admin status:",L)}})();const j=await fetch("/api/business/details",{method:"GET",headers:{Authorization:`Bearer ${k}`,"Content-Type":"application/json",Accept:"application/json"}});if(!j.ok){if(j.status===401){localStorage.removeItem("mpbh_token"),m("/login");return}throw new Error(`Failed to fetch business data: ${j.status}`)}const v=await j.json();if(v.status==="success"&&v.data){const L={id:v.data.id,name:v.data.name,category:v.data.category,district:v.data.district,description:v.data.description,address:v.data.address,phone:v.data.phone,email:v.data.email,website:v.data.website,package_type:v.data.package_type||"Basic",adverts_remaining:v.data.adverts_remaining||0,rating:v.data.rating||0,subscription:{status:"active",next_billing_date:"2025-05-01",amount:0},statistics:{views:((n=v.data.statistics)==null?void 0:n.views)||0,contacts:((u=v.data.statistics)==null?void 0:u.contacts)||0,reviews:v.data.review_count||0}};o(L)}else console.error("API returned an error:",v),console.error("API returned an error:",v),localStorage.removeItem("mpbh_token"),m("/login")}catch(b){console.error("Error fetching business data:",b),console.error("Error fetching business data:",b),localStorage.removeItem("mpbh_token"),m("/login")}finally{i(!1)}})()},[]);const w=()=>{localStorage.removeItem("mpbh_token"),localStorage.removeItem("mpbh_user"),m("/login"),window.location.reload()},l=()=>{a(!x)};return t?e.jsx("div",{className:"min-h-screen bg-brand-gray-100 flex justify-center items-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-black"})}):e.jsxs("div",{className:"min-h-screen bg-brand-gray-100",children:[e.jsx("header",{className:"bg-brand-white shadow-brand-sm",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{className:"lg:hidden mr-4 text-gray-500 hover:text-gray-700",onClick:l,children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Business Dashboard"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[f&&e.jsx(C,{to:"/admin",className:"bg-purple-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-purple-700",children:"Admin Dashboard"}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-gray-800",children:s.name}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full mr-1 ${s.package_type==="Gold"?"bg-tier-gold":s.package_type==="Silver"?"bg-tier-silver":s.package_type==="Bronze"?"bg-tier-bronze":"bg-tier-basic"}`}),s.package_type," Package"]})]}),e.jsx("div",{className:"relative",children:e.jsx("button",{className:"h-10 w-10 rounded-full bg-brand-gray-100 flex items-center justify-center text-brand-black font-bold uppercase",children:s.name.charAt(0)})})]})]})}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsx("aside",{className:`lg:w-1/4 bg-brand-white rounded-lg shadow-brand-md overflow-hidden ${x?"block":"hidden"} lg:block`,children:e.jsx("nav",{className:"p-4",children:e.jsxs("ul",{className:"space-y-2",children:[e.jsx("li",{children:e.jsx(C,{to:"/dashboard",className:`block px-4 py-2 rounded-md ${r("/dashboard")?"bg-brand-black text-brand-white":"hover:bg-brand-gray-100"}`,onClick:()=>a(!1),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-5 w-5 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),"Dashboard Home"]})})}),e.jsxs("li",{children:[f&&e.jsx(C,{to:"/admin",className:`block px-4 py-2 rounded-md ${r("/admin")?"bg-brand-black text-brand-white":"hover:bg-brand-gray-100"}`,onClick:()=>a(!1),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-5 w-5 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})}),"Admin Panel"]})}),e.jsx(C,{to:"/dashboard/profile",className:`block px-4 py-2 rounded-md ${r("/dashboard/profile")?"bg-brand-black text-brand-white":"hover:bg-brand-gray-100"}`,onClick:()=>a(!1),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-5 w-5 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Business Profile"]})})]}),e.jsx("li",{children:e.jsx(C,{to:"/dashboard/hours",className:`block px-4 py-2 rounded-md ${r("/dashboard/hours")?"bg-brand-black text-brand-white":"hover:bg-brand-gray-100"}`,onClick:()=>a(!1),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-5 w-5 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Business Hours"]})})}),e.jsx("li",{children:e.jsx(C,{to:"/dashboard/products",className:`block px-4 py-2 rounded-md ${r("/dashboard/products")?"bg-brand-black text-brand-white":"hover:bg-brand-gray-100"}`,onClick:()=>a(!1),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-5 w-5 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),"Manage Products",(s.package_type==="Basic"||s.package_type==="Bronze")&&e.jsx("span",{className:"ml-2 text-xs bg-brand-gray-100 text-brand-gray-700 px-2 py-1 rounded",children:"Upgrade"})]})})}),e.jsx("li",{children:e.jsx(C,{to:"/dashboard/adverts",className:`block px-4 py-2 rounded-md ${r("/dashboard/adverts")?"bg-brand-black text-brand-white":"hover:bg-brand-gray-100"}`,onClick:()=>a(!1),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-5 w-5 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"})}),"Adverts Management",e.jsx("span",{className:"ml-2 bg-brand-gray-100 text-brand-black text-xs px-2 py-1 rounded",children:s.adverts_remaining})]})})}),e.jsx("li",{children:e.jsx(C,{to:"/dashboard/payments",className:`block px-4 py-2 rounded-md ${r("/dashboard/payments")?"bg-brand-black text-brand-white":"hover:bg-brand-gray-100"}`,onClick:()=>a(!1),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-5 w-5 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})}),"Payment History"]})})}),e.jsx("li",{children:e.jsx(C,{to:"/dashboard/upgrade",className:`block px-4 py-2 rounded-md ${r("/dashboard/upgrade")?"bg-brand-black text-brand-white":"hover:bg-brand-gray-100"}`,onClick:()=>a(!1),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-5 w-5 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),"Upgrade Plan"]})})}),e.jsx("li",{className:"border-t mt-4 pt-4",children:e.jsx(C,{to:"/dashboard/session-management",className:"block px-4 py-2 rounded-md hover:bg-brand-gray-100 text-brand-gray-700",onClick:()=>a(!1),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-5 w-5 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),"Manage Sessions"]})})}),e.jsxs("li",{children:[e.jsxs(C,{to:"/dashboard/social-media",className:`flex items-center p-2 rounded hover:bg-brand-gray-100 ${d.pathname==="/dashboard/social-media"?"bg-brand-gray-100":""}`,onClick:()=>a(!1),children:[e.jsx("svg",{className:"w-5 h-5 mr-2 text-brand-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Social Media"]}),e.jsx("button",{onClick:w,className:"block w-full text-left px-4 py-2 rounded-md hover:bg-brand-gray-100 text-brand-gray-700",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-5 w-5 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),"Logout"]})})]})]})})}),e.jsx("main",{className:"flex-1 bg-brand-white rounded-lg shadow-brand-md p-6",children:s?e.jsxs(Y,{children:[e.jsx(B,{path:"/",element:e.jsx(se,{businessData:s})}),e.jsx(B,{path:"/profile",element:e.jsx(oe,{businessData:s,updateBusinessData:p})}),e.jsx(B,{path:"/hours",element:e.jsx(ge,{businessData:s})}),e.jsx(B,{path:"/products",element:e.jsx(de,{businessData:s})}),e.jsx(B,{path:"/adverts",element:e.jsx(he,{businessData:s})}),e.jsx(B,{path:"/payments",element:e.jsx(xe,{businessData:s})}),e.jsx(B,{path:"/upgrade",element:e.jsx(ue,{businessData:s,onUpgrade:S})}),e.jsx(B,{path:"/session-management",element:e.jsx(pe,{})}),e.jsx(B,{path:"/social-media",element:e.jsx(be,{businessData:s,onUpdate:p})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"No Business Profile Found"}),e.jsx("p",{className:"mb-6",children:"You need to register a business to access the dashboard features."}),e.jsx(C,{to:"/register",className:"px-4 py-2 bg-brand-black text-brand-white font-medium rounded hover:bg-brand-gray-800 transition-colors",children:"Register a Business"})]})})]})})]})}export{_e as default};
